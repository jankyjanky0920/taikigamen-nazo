<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è¬è§£ãä¸€è¦§</title>
  <link rel="stylesheet" href="style.css">
  <script src="data.js"></script>
</head>
<body>
  <h1 id="site-title">è¬è§£ãç­”ãˆåˆã‚ã›ã‚µã‚¤ãƒˆ</h1>
  <div id="quiz-list"></div>

  <script>
    const listContainer = document.getElementById("quiz-list");

    // âœ… é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¶å¾¡
    let tapCount = 0;
    let devMode = localStorage.getItem("devMode") === "true";

    function toggleDevMode(enable) {
      devMode = enable;
      localStorage.setItem("devMode", enable ? "true" : "false");
      alert(enable ? "âœ… é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ" : "ğŸšª é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†ã—ã¾ã—ãŸ");
      renderList();
    }

    document.getElementById("site-title").addEventListener("click", () => {
      tapCount++;
      if (tapCount >= 5) {
        if (devMode) {
          toggleDevMode(false);
        } else {
          const pw = prompt("é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:");
          if (pw === "hahaha") {
            toggleDevMode(true);
          } else {
            alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
          }
        }
        tapCount = 0;
      }
    });

    // âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—é–¢æ•°ï¼ˆquiz.htmlã¨å…±é€šä»•æ§˜ï¼‰
    function getCurrentStatus(quiz) {
      const saved = localStorage.getItem(`status_${quiz.id}`);
      if (saved) return saved;

      const startTime = new Date(quiz.startTime);
      const now = new Date();
      const diff = now - startTime;

      if (diff < 0) return "éå…¬é–‹";
      if (diff < 60 * 60 * 1000) return "å‡ºé¡Œ";
      if (diff < 24 * 60 * 60 * 1000) return "å‡ºé¡ŒçµŒé";
      return "å…¬é–‹";
    }

    // âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¿å­˜
    function setStatus(quiz, newStatus) {
      localStorage.setItem(`status_${quiz.id}`, newStatus);
    }

    // âœ… ã‚¯ã‚¤ã‚ºä¸€è¦§æç”»
    function renderList() {
      listContainer.innerHTML = ""; // åˆæœŸåŒ–

      quizzes.forEach(q => {
        const status = getCurrentStatus(q);

        // ğŸ”¸ éå…¬é–‹ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãŸã ã—é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãªã‚‰è¡¨ç¤ºï¼‰
        if (status === "éå…¬é–‹" && !devMode) return;

        const card = document.createElement("div");
        card.className = "quiz-card";

        // ğŸ”§ é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†UI
        let devControls = "";
        if (devMode) {
          devControls = `
            <div class="dev-status">
              <label>çŠ¶æ…‹:</label>
              <select id="status-${q.id}">
                <option value="éå…¬é–‹" ${status === "éå…¬é–‹" ? "selected" : ""}>éå…¬é–‹</option>
                <option value="å‡ºé¡Œ" ${status === "å‡ºé¡Œ" ? "selected" : ""}>å‡ºé¡Œ</option>
                <option value="å‡ºé¡ŒçµŒé" ${status === "å‡ºé¡ŒçµŒé" ? "selected" : ""}>å‡ºé¡ŒçµŒé</option>
                <option value="å…¬é–‹" ${status === "å…¬é–‹" ? "selected" : ""}>å…¬é–‹</option>
              </select>
              <button data-id="${q.id}" class="apply-status">å¤‰æ›´</button>
            </div>
          `;
        }

        card.innerHTML = `
          <img src="${q.thumbnail}" alt="${q.title}" class="thumb">
          <h3>${q.title}</h3>
          ${
            status === "éå…¬é–‹" && !devMode
              ? ""
              : `<a href="quiz.html?id=${q.id}">æŒ‘æˆ¦ã™ã‚‹</a>`
          }
          ${devMode ? `<p style="color:red;">[ç¾åœ¨: ${status}]</p>${devControls}` : ""}
        `;
        listContainer.appendChild(card);
      });

      // âœ… é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´å‡¦ç†
      if (devMode) {
        document.querySelectorAll(".apply-status").forEach(btn => {
          btn.addEventListener("click", e => {
            const id = parseInt(e.target.getAttribute("data-id"));
            const quiz = quizzes.find(q => q.id === id);
            const select = document.getElementById(`status-${id}`);
            const newStatus = select.value;
            setStatus(quiz, newStatus);
            alert(`ğŸ›  ${quiz.title} ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œ${newStatus}ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ`);
            renderList(); // å†æç”»
          });
        });
      }

      if (!devMode && listContainer.children.length === 0) {
        listContainer.innerHTML = "<p>ç¾åœ¨å…¬é–‹ä¸­ã®å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
      }
    }

    // âœ… åˆæœŸè¡¨ç¤º
    renderList();
  </script>
</body>
</html>
